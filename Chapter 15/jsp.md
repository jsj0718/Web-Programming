# Chapter 15. JSP



## 01. JSP 개요

* 서버와 클라이언트

  * 클라이언트-사이드 : 인터넷에서 클라이언트 컴퓨터 쪽에서 실행되는 프로그램

    * 클라이언트: 서버에게 웹 페이지를 요구

  * 서버-사이드 : 웹 서버는 웹 페이지를 찾아서 클라이언트에게 전달

    * GCI(Common Gateway Interface) : 서버 쪽 도우미 프로그램

      C, Python, JAVA, PHP, ASP 등이 있다.

      그 중에서 Java는 플랫폼에 독립적이고 스레드를 사용할 수 있어서 효율적이며, 풍부한 라이브러리가 장점이다.

      자바를 서버 쪽에 사용하는 기술로 서블릿(Servlet) 이 있다.

      >* 서블릿 장점
      >
      >1. 효율적 (CGI는 서버 자원을 많이 사용하는데, 스레드를 생성하여 각 요청을 서비스하므로 효율적이다.)
      >
      >2. 편리 (이미 Java를 알고 있는 개발자는 새로운 스크립트 언어를 학습할 필요가 없다.)
      >
      >3. 강력 (자바 서블릿을 사용하면 기존 CGI으로 어려웠던 작업들을 쉽게 처리할 수 있다. 예를 들어 서블릿은 웹 서버와 직접 통신이 가능하다.)
      >
      >4. 이식성 존재 
      >
      >   (서블릿은 자바 언어를 사용하며, 표준화되어 있는 라이브러리를 사용한다. 
      >
      >   자바 자체가 바이트 코드로 작성된 코드를 가상 기계 위에서 실행하는 방식이므로 서블릿도 플랫폼 종류 상관없이 실행 가능하다.)
      >
      > 
      >
      >* 서블릿 단점
      >  1. 그러나 서블릿은 자바 언어 안에 HTML 코드를 넣어야 하므로 어려운 점이 존재했다. 
      >  2. 자바 개발자는 HTML을 모르고, 디자이너는 자바를 모르기 때문이다.
      >
      > 
      >
      >* JSP (Java Server Page)
      >
      >  JSP는 서블릿 단점을 해결하기 위해 개발되었다.
      >
      >  JSP는 자바를 기반으로 동적인 웹 페이지를 구축할 수 있는 서버-사이드 스크립트 언어로 자바 서블릿을 기반으로 한다.
      >
      >  JSP는 서블릿과 반대로, HTML 문서 안에 필요할 때만 자바 코드가 들어간다. 
      >
      >  개발자가 HTML 페이지 안에 필요할 때마다 (%...%)를 통해 삽입 가능하다.
      >
      > 
      >
      >* JSP 엔진
      >
      >  웹 서버가 JSP를 처리하기 위해서 JSP 엔진을 가지고 있어야 한다.
      >
      >  JSP 엔진이란 JSP를 처리하는 컨테이너이다.
      >
      >  JSP 컨테이너는 JSP 페이지에 대한 요청을 받는다.
      >
      >  (e.x. 아파치 톰캣이란 웹 서버는 JSP 컨테이너를 내장한다.)
      >
      >  JSP 컨테이너는 JSP가 필요로 하는 실행 환경과 다른 서비스를 제공하기 위해 웹 서버와 함께 작업한다.
      >
      >  JSP 컨테이너는 JSP에 속하는 요소를 처리하게 된다.
      >
      > 
      >
      >* JSP 처리 과정
      >  1. 클라이언트가 URL을 통해 JSP 페이지를 요청
      >  2. 웹 서버가 이 요청을 서블릿 컨테이너로 전송
      >  3. 서블릿 컨테이너는 요청된 JSP 페이지를 검색해 이것을 자바 파일로 변환 후 컴파일해서 서블릿 객체를 생성
      >  4. 이 객체가 서블릿 컨테이너에 로딩되어 실행
      >  5. 실행된 결과는 웹 서버를 통해 클라이언트에 응답 형태로 전달됨
      >  6. 이 변환은 한 번만 일어나므로 속도는 느려지지 않는다.



## 04. 기본적인 JSP

* JSP 수식

  * 어떤 HTML 파일도 확장자만 jsp로 변경하면 jsp파일로 변환 가능
  * HTML 안에 자바를 내장하는 방법

  ```html
  <!-- 자바 수식, 실행될 때마다 새롭게 실행된다. -->
  <%= expression %> 
  ```

  * 수식은 실행 시간에 계산된 후 string 객체로 변환되어 수식으로 나타나는 위치에 삽입된다.
    * 자바에는 String이라는 Class가 존재한다. String Class는 문자열을 손쉽게 사기 위해서 존재하는 Class 이다.
  * 수식은 Java에서 유효한 수식이면 어떤 것이든 가능하며, 문장 끝에 ;를 붙이면 안된다.

  > 서버 관점에서 바라보기
  >
  > 1. JSP 파일이 최초로 사용되면 톰캣은 JSP를 서블릿으로 변환하고 서블릿을 컴파일하여 실행한다.
  > 2. 서블릿 코드는 톰캣의 "work\Catalina\localhost\Hello" 디렉토리에서 찾을 수 있다.
  > 3. 이름은 hello_jsp.java로 저장되어 있다.
  >
  > ```html
  > out.write("<!DOCTYPE html>\r\n");
  >       out.write("<html lang=\"en\">\r\n");
  >       out.write("<head>\r\n");
  >       out.write("    <meta charset=\"UTF-8\">\r\n");
  >       out.write("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n");
  >       out.write("    \r\n");
  >       out.write("    <title>Hello World</title>\r\n");
  >       out.write("</head>\r\n");
  >       out.write("<body>\r\n");
  >       out.write("    안녕하세요. 현재 시각은 ");
  >       out.print( new java.util.Date() );
  >       out.write("입니다.\r\n");
  >       out.write("</body>\r\n");
  >       out.write("</html>");
  > ```
  >
  > * HTML 문장은 out.write를 이용해 그대로 출력
  > * JSP 수식은 계산되고 계산 결과값이 response 메시지 일부로 출력
  > * 동일한 JSP 파일을 다시 사용할 때는 속도가 빨라진다. 왜냐하면 미리 변환된 서블릿 코드가 바로 실행되기 때문이다. (JSP -> 서블릿 변환과 서블릿 컴파일 과정 생략)



* 스크립틀릿

<%= %> 안에 자바 수식을 내장할 수 있지만, 많은 코드를 넣을 수 없다. 하지만 JSP는 JSP 안에 상당히 많은 분량의 자바 코드 블록을 작성할 수 있도록 허용한다.

코드 블록은 <% %> 사이에 넣으면 된다. (= 생략)

```java
// 스크립틀릿
<% code_block %>
```

